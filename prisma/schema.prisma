// Prisma schema file,

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum ProjectStatus {
  PLANNED
  ACTIVE
  ON_HOLD
  COMPLETED
  CANCELLED
}

enum ProjectPriority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum ProjectType {
  AUTOMATION
  DESIGN
  ELECTRONICS
  GENERAL
  MAKER
  REPAIR
  WEBAPP
  WEBSITE
  WRITING
  OTHER
}

enum TaskStatus {
  TODO
  IN_PROGRESS
  BLOCKED
  DONE
  CANCELLED
}

enum TaskPriority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum CostType {
  PARTS
  LABOR
  SOFTWARE
  TOOLS
  CONSUMABLES
  TRAVEL
  MISC
}

enum RelationshipType {
  BLOCKS
  DEPENDS_ON
  RELATED
}

enum MilestoneStatus {
  PLANNED
  IN_PROGRESS
  ON_HOLD
  COMPLETED
  CANCELLED
}

model Tag {
  id                  String             @id @default(cuid())
  name                String             @unique
  projects            Project[]          @relation("ProjectTags")
  tasks               Task[]             @relation("TaskTags")

  createdAt           DateTime           @default(now())
  updatedAt           DateTime           @updatedAt
}

model Project {
  id                  String             @id @default(cuid())
  name                String
  description         String?
  type                ProjectType        @default(OTHER)
  status              ProjectStatus      @default(PLANNED)
  priority            ProjectPriority    @default(MEDIUM)
  startDate           DateTime?
  dueDate             DateTime?
  budget              Decimal?           @db.Decimal(10, 2)
  actualCost          Decimal            @db.Decimal(10, 2) @default(0.00)
  completionPercent   Decimal            @db.Decimal(10, 2) @default(0.0)
  archived            Boolean            @default(false)

  tags                Tag[]              @relation("ProjectTags")
  tasks               Task[]             @relation("ProjectTasks")
  costs               Cost[]             @relation("ProjectCosts")
  milestones          Milestone[]        @relation("ProjectMilestones")
  
  createdAt           DateTime           @default(now())
  updatedAt           DateTime           @updatedAt
}

model Task {
  id                  String             @id @default(cuid())
  title               String
  description         String?
  status              TaskStatus         @default(TODO)
  priority            TaskPriority       @default(MEDIUM)
  startDate           DateTime?
  dueDate             DateTime?
  completedAt         DateTime?
  projectId           String
  project             Project            @relation("ProjectTasks", fields: [projectId], references: [id])
  parentTaskId        String?
  parentTask          Task?              @relation("SubTasks", fields: [parentTaskId], references: [id])
  subTasks            Task[]             @relation("SubTasks")
  archived            Boolean            @default(false)
  order               Int?
  tags                Tag[]              @relation("TaskTags")
  costs               Cost[]             @relation("TaskCosts")
  milestones          Milestone[]        @relation("TaskMilestones")
  sourceRelationships TaskRelationship[] @relation("SourceTaskRelations")
  targetRelationships TaskRelationship[] @relation("TargetTaskRelations")

  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
}

model Cost {
  id                  String             @id @default(cuid())
  amount              Decimal            @db.Decimal(10, 2)
  type                CostType
  note                String?
  date                DateTime?          @default(now())
  projectId           String
  project             Project            @relation("ProjectCosts", fields: [projectId], references: [id])
  taskId              String?
  task                Task?              @relation("TaskCosts", fields: [taskId], references: [id])

  createdAt           DateTime           @default(now())
  updatedAt           DateTime           @updatedAt
}

model TaskRelationship {
  id                  String             @id @default(cuid())
  sourceTaskId        String
  sourceTask          Task               @relation("SourceTaskRelations", fields: [sourceTaskId], references: [id])
  targetTaskId        String
  targetTask          Task               @relation("TargetTaskRelations", fields: [targetTaskId], references: [id])
  relationshipType    RelationshipType
  
  createdAt           DateTime           @default(now())
  updatedAt           DateTime           @updatedAt
}

model Milestone {
  id                  String             @id @default(cuid())
  name                String   
  description         String?  
  targetDate          DateTime? 
  status              MilestoneStatus    @default(PLANNED)
  projectId           String
  project             Project            @relation("ProjectMilestones", fields: [projectId], references: [id])
  tasks               Task[]             @relation("TaskMilestones")

  createdAt           DateTime           @default(now())
  updatedAt           DateTime           @updatedAt
}
